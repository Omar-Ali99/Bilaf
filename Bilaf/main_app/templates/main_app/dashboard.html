{% extends 'main_app/home_page.html' %}
{% block title %}Dashboard{% endblock %}


{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.js"></script>

<div class="w-full p-8 grid grid-cols-5 gap-4">
    <div class="flex flex-column col-span-3 gap-4">
        <div class="grid grid-cols-4 gap-4">
            <div class="p-6 bg-white border border-gray-50 rounded-lg shadow flex items-center flex-column">
                <div class="p-3 inline-block w-fit rounded-lg" style="background-color: #ffeef3;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
                        <g fill="#ffacc5">
                            <path
                                d="M12.28 21.554a1.797 1.797 0 0 1 .664-1.926c.493-.364 1.078-.483 1.571-.366a.19.19 0 0 0 .181-.047a.178.178 0 0 0 .017-.233l-.093-.127c-.612-.827-.307-2.09.68-2.834a31.904 31.904 0 0 0-.471-.314l-.178-.116a31.79 31.79 0 0 1-.64-.425a3.733 3.733 0 0 1-2.01.584a3.74 3.74 0 0 1-2.763-1.214c-.407.221-.883.444-1.374.635c-.801.312-1.735.579-2.532.579c-1.03 0-2.094-.446-2.92-.9C3.64 18.986 7.469 22 12.002 22c.213 0 .34-.242.28-.446ZM9.75 12a2.25 2.25 0 1 1 3.83 1.602a.75.75 0 0 0-.142.126l-.01.012A2.25 2.25 0 0 1 9.75 12Z" />
                            <path fill-rule="evenodd"
                                d="M19.48 14.795c.707-.523 1.607-.539 2.147-.078A10.02 10.02 0 0 0 22 12a9.954 9.954 0 0 0-1.565-5.374l-.905.904a.75.75 0 1 1-1.06-1.06l1-1a.74.74 0 0 1 .058-.053A9.976 9.976 0 0 0 12.001 2a9.953 9.953 0 0 0-5.375 1.565l.904.905a.75.75 0 1 1-1.06 1.06l-1-1a.758.758 0 0 1-.053-.058a9.976 9.976 0 0 0-3.381 8.372c.216.154.484.333.784.512c.818.487 1.752.894 2.512.894c.516 0 1.243-.187 1.987-.477c.42-.163.816-.348 1.145-.524a3.75 3.75 0 1 1 6.646.848l.371.245l.17.11c.477.313 1.062.7 1.38 1.018a.747.747 0 0 1 .037.04c.475.059.901.28 1.182.66l.275.373a.086.086 0 0 0 .13.01a.089.089 0 0 0 .024-.075c-.078-.586.213-1.249.8-1.683ZM16.45 4.4a.75.75 0 0 1 .15 1.05l-1.5 2a.75.75 0 1 1-1.2-.9l1.5-2a.75.75 0 0 1 1.05-.15Zm-5.98-.93a.75.75 0 0 0 0 1.06l1 1a.75.75 0 1 0 1.06-1.06l-1-1a.75.75 0 0 0-1.06 0ZM8.41 7.56a.75.75 0 0 0 .918.53l1.366-.366a.75.75 0 0 0-.388-1.448l-1.366.366a.75.75 0 0 0-.53.918Zm-2.513-.386a.75.75 0 0 0-.372.993l.585 1.287a.75.75 0 0 0 1.365-.62L6.89 7.545a.75.75 0 0 0-.993-.372Zm10.854 3.964a.75.75 0 0 0 .714-.784L17.4 8.941a.75.75 0 0 0-1.498.07l.066 1.414a.75.75 0 0 0 .784.713Zm1.686.92a.75.75 0 0 0 1.058.068l1.678-1.478a.75.75 0 0 0-.99-1.126L18.503 11a.75.75 0 0 0-.067 1.059ZM6.943 10.896a.75.75 0 0 1 .162 1.048l-.835 1.141a.75.75 0 0 1-1.21-.886l.835-1.14a.75.75 0 0 1 1.048-.163ZM3.563 8.19a.75.75 0 0 0-.707.79l.078 1.413a.75.75 0 0 0 1.498-.084l-.079-1.412a.75.75 0 0 0-.79-.707Z"
                                clip-rule="evenodd" />
                        </g>
                    </svg>
                </div>
                <p class="text-gray-500 uppercase font-semibold tracking-wider text-xl pt-3">Different products</p>
                <h1 class="text-6xl pt-3 font-semibold">{{ products.count }}</h1>
            </div>
            <div class="flex-auto p-6 bg-white border border-gray-50 rounded-lg shadow flex items-center flex-column">
                <div class="p-3 inline-block w-fit rounded-lg" style="background-color: #eef8ff;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
                        <g fill="#aadbff">
                            <circle cx="12" cy="6" r="4" />
                            <path d="M20 17.5c0 2.485 0 4.5-8 4.5s-8-2.015-8-4.5S7.582 13 12 13s8 2.015 8 4.5Z" />
                        </g>
                    </svg>
                </div>
                <p class="text-gray-500 uppercase font-semibold tracking-wider text-xl pt-3">Unique customers</p>
                <h1 class="text-6xl pt-3 font-semibold">{{ unique_customers }}</h1>
            </div>
            <div class="flex-auto p-6 bg-white border border-gray-50 rounded-lg shadow flex items-center flex-column">
                <div class="p-3 inline-block w-fit rounded-lg" style="background-color: #f1f1ff">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
                        <g fill="#b8b8ff">
                            <path d="M12 10a4 4 0 1 0 0-8a4 4 0 0 0 0 8Z" />
                            <path
                                d="M2.728 5.818a.75.75 0 1 0-1.455.364l.382 1.528a8.21 8.21 0 0 0 5.595 5.869v4.473c0 .898 0 1.648.08 2.242c.084.628.27 1.195.726 1.65c.455.456 1.022.642 1.65.726c.595.08 1.344.08 2.242.08h.104c.899 0 1.648 0 2.243-.08c.627-.084 1.194-.27 1.65-.726c.455-.455.64-1.022.725-1.65c.08-.594.08-1.344.08-2.242v-4.193a2.624 2.624 0 0 1 1.856 2.208l.65 5.52a.75.75 0 0 0 1.489-.175l-.65-5.52A4.124 4.124 0 0 0 16 12.25H8.085A6.709 6.709 0 0 1 3.11 7.346l-.382-1.528Z" />
                        </g>
                    </svg>
                </div>
                <p class="text-gray-500 uppercase font-semibold tracking-wider text-xl pt-3">Served orders</p>
                <h1 class="text-6xl pt-3 font-semibold">{{ served_orders.count }}</h1>
            </div>
            <div class="flex-auto p-6 bg-white border border-gray-50 rounded-lg shadow flex items-center flex-column">
                <div class="p-3 inline-block w-fit rounded-lg" style="background-color: #fff3f1;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
                        <path fill="#fec5bb"
                            d="M8.25 5c-2.317.006-3.557.063-4.472.674a4 4 0 0 0-1.104 1.104C2 7.787 2 9.19 2 12c0 2.809 0 4.213.674 5.222a4 4 0 0 0 1.104 1.104c.915.611 2.155.668 4.472.674v-4.095a3.001 3.001 0 0 1 0-5.81V5Zm1.5 14h4.5V5h-4.5v14Zm6-14v4.095a3.001 3.001 0 0 1 0 5.81V19c2.317-.006 3.558-.063 4.472-.674a4.003 4.003 0 0 0 1.104-1.104C22 16.213 22 14.81 22 12c0-2.809 0-4.213-.674-5.222a4.002 4.002 0 0 0-1.104-1.104c-.915-.611-2.155-.668-4.472-.673Z" />
                    </svg>
                </div>
                <p class="text-gray-500 uppercase font-semibold tracking-wider text-xl pt-3">total earnings</p>
                <h1 class="text-6xl pt-3 font-semibold">{{ product_total_earnings }} SR</h1>
            </div>
        </div>
        <div class="block p-6 bg-white border border-gray-200 rounded-lg shadow">
            <h2 class="text-3xl font-semibold text-left text-gray-900 bg-white mb-4 text-capitalize">
                top sales
            </h2>
            <div>
                <canvas id="soldItemsChart"></canvas>
            </div>
        </div>
    </div>

    <div class="flex flex-column col-span-2 gap-4">
        <div class="flex flex-column block p-6 bg-white border border-gray-200 rounded-lg shadow">
            <h2 class="text-3xl font-semibold text-left text-gray-900 bg-white mb-4 text-capitalize">
                product sales
            </h2>
            <table class="text-xl text-left text-gray-500">
                <thead class="w-full text-gray-700 uppercase bg-gray-100">
                    <tr>
                        <th scope="col" class="px-6 py-3" style="min-width: 10%">
                            ID
                        </th>
                        <th scope="col" class="px-6 py-3" style="min-width: 25%">
                            Name
                        </th>
                        <th scope="col" class="px-6 py-3" style="min-width: 25%">
                            Category
                        </th>
                        <th scope="col" class="px-6 py-3" style="min-width: 10%">
                            Count
                        </th>
                        <th scope="col" class="px-6 py-3" style="min-width: 30%">
                            Sales
                        </th>
                    </tr>
                </thead>
                <tbody class="text-2xl text-black">
                    {% for product in products %}
                    <tr class="bg-white">
                        <th scope="row" class="px-6 py-4 text-gray-900 whitespace-nowrap">
                            <div class="font-normal text-gray-500">{{ product.id }}</div>
                        </th>
                        <td class="px-6 py-4">
                            {{ product.name }}
                        </td>
                        <td class="px-6 py-4">
                            {{ product.category.name }}
                        </td>
                        <td class="px-6 py-4">
                            {{ product.total_sold_units }}
                        </td>
                        <td class="px-6 py-4">
                            {{ product.total_earnings }} SR
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6">No products available</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr class="font-semibold text-gray-900 text-2xl">
                        <td class="px-6 py-3">Total</td>
                        <td class="px-6 py-3"></td>
                        <td class="px-6 py-3"></td>
                        <td class="px-6 py-3">{{ product_total_units_sold }}</td>
                        <td class="px-6 py-3">{{ product_total_earnings }} SR</td>
                    </tr>
                </tfoot>
            </table>
            <p class="text-lg font-normal text-gray-500 mt-2">
                This table provides an overview of the diverse range of products available for purchase on our store.
            </p>
        </div>

        <div class="flex flex-column block p-6 bg-white border border-gray-200 rounded-lg shadow">
            <h2 class="text-3xl font-semibold text-left text-gray-900 bg-white mb-4 text-capitalize">
                category sales
            </h2>
            <table class="text-xl text-left text-gray-500">
                <thead class="w-full text-gray-700 uppercase bg-gray-100">
                    <tr>
                        <th scope="col" class="px-6 py-3" style="min-width: 5%">
                            ID
                        </th>
                        <th scope="col" class="px-6 py-3" style="min-width: 50%">
                            Name
                        </th>
                        <th scope="col" class="px-6 py-3" style="min-width: 20%">
                            Count
                        </th>
                        <th scope="col" class="px-6 py-3" style="min-width: 25%">
                            Total Sales
                        </th>
                    </tr>
                </thead>
                <tbody class="text-2xl text-black">
                    {% for category in categories %}
                    <tr class="bg-white">
                        <th scope="row" class="px-6 py-4 text-gray-900 whitespace-nowrap">
                            <div class="font-normal text-gray-500">{{ category.id }}</div>
                        </th>
                        <td class="px-6 py-4">
                            {{ category.name }}
                        </td>
                        <td class="px-6 py-4">
                            {{ category.total_sold_units }}
                        </td>
                        <td class="px-6 py-4">
                            {{ category.total_earnings }} SR
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6">No categories available</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr class="font-semibold text-gray-900 text-2xl">
                        <td class="px-6 py-3">Total</td>
                        <td class="px-6 py-3"></td>
                        <td class="px-6 py-3">{{ category_total_units_sold }}</td>
                        <td class="px-6 py-3">{{ category_total_earnings }} SR</td>
                    </tr>
                </tfoot>
            </table>
            <p class="text-lg font-normal text-gray-500 mt-2">
                This table displays the diverse product categories available for customers to explore on our store.
            </p>
        </div>

    </div>

</div>

<script>
    const ctx = document.getElementById('soldItemsChart');

    var charLabels = [];
    var charData = [];

    {% for product in products %}
    charLabels.push("{{ product.name }}");
    charData.push({{ product.total_earnings }});
    {% endfor %}

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: charLabels,
            datasets: [{
                label: 'Sold Units',
                data: charData,
                borderWidth: 1,
                borderColor: '#7fad39',
                backgroundColor: '#cde3ab'
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            },
            responsive: true,
            maintainAspectRatio: false,
            aspectRatio: 0.55
        }
    });
</script>


{% endblock %}